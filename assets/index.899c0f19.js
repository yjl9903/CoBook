var _e=Object.defineProperty;var M=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var z=(n,e,t)=>e in n?_e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W=(n,e)=>{for(var t in e||(e={}))ve.call(e,t)&&z(n,t,e[t]);if(M)for(var t of M(e))ge.call(e,t)&&z(n,t,e[t]);return n};import{v as he,a as ye,d as N,b as C,u as we,c as be,r as y,e as R,f as g,o as f,g as E,h as l,i as w,w as c,j as d,t as k,k as u,I as ke,P as Ee,N as xe,l as Y,F as $,p as $e,m as Ce,n as Fe,q as D,C as Se,s as Ve,x as Z,y as De,A as ee,z as Le,B as T,D as te,E as Be,G as L,H as A,L as Pe,J as Oe,K as j,T as Re,M as ne,O as Te,Q as Ae,R as G,S as je,U as Ie,V as Ne,W as Ue,X as oe,Y as ae,Z as He,_ as Me,$ as ze,a0 as We,a1 as Ge}from"./vendor.0089f223.js";const qe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}};qe();function Ke(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:o,onRegisterError:r}=n;let i;const _=async(a=!0)=>{};return"serviceWorker"in navigator&&(i=new he("/sw.js",{scope:"/",type:"classic"}),i.addEventListener("activated",a=>{a.isUpdate?window.location.reload():s==null||s()}),i.register({immediate:e}).then(a=>{o==null||o(a)}).catch(a=>{r==null||r(a)})),_}const I="Coin Book",se="https://cobook-worker.yjl9903.workers.dev",Je=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Tea"]}],re=[{name:"Breakfast",color:"#f9a8d4"},{name:"Lunch",color:"#fcd34d"},{name:"Dinner",color:"#fdba74"},{name:"Tea",color:"#6ee7b7"}],P=[{name:"Food",color:"#d8b4fe"},{name:"Drink",color:"#cbd5e1"}];var Qe=Object.defineProperty,Xe=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,K=(n,e,t)=>e in n?Qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,J=(n,e)=>{for(var t in e||(e={}))Ze.call(e,t)&&K(n,t,e[t]);if(q)for(var t of q(e))et.call(e,t)&&K(n,t,e[t]);return n},Q=(n,e)=>Xe(n,Ye(e)),S=class{constructor(n,e,t){this.errorHandler=[],this.fingerprint=t,this.api=ye.create({baseURL:n,headers:{Authorization:e}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(n){const{data:e}=await this.api.post("/account",Q(J({},n),{timestamp:new Date().toISOString(),fingerprint:this.fingerprint}));if(S.isResponseError(e))throw await this.handleError(e),e;return e}async update(n,e){const{data:t}=await this.api.put(`/account/${n}`,Q(J({},e),{fingerprint:this.fingerprint}));if(S.isResponseError(t))throw await this.handleError(t),t;return t}async delete(n){const{data:e}=await this.api.delete(`/account/${n}`);return!S.isResponseError(e)}async list(){const{data:n}=await this.api.get("/accounts");if(S.isResponseError(n))throw await this.handleError(n),n;return n.accounts}static isResponseError(n){return!n||n.status==="ERROR"}onError(n){this.errorHandler.push(n)}async handleError(n){await Promise.all(this.errorHandler.map(e=>e(n)))}};const tt="modulepreload",X={},nt="/",O=function(e,t){return!t||t.length===0?e():Promise.all(t.map(s=>{if(s=`${nt}${s}`,s in X)return;X[s]=!0;const o=s.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":tt,o||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),o)return new Promise((_,a)=>{i.addEventListener("load",_),i.addEventListener("error",a)})})).then(()=>e())};async function le(){return await(await(await O(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const ot=le();async function at(){try{return await ot}catch{return await le()}}const V=N("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:n=>new S(se,n.pass,n.fingerprint)},persist:!0}),ue=N("authorization/valid",{state:()=>({ok:!1})});async function ie(){const n=ue();if(n.ok)return!0;const e=V(),t=e.pass!==""&&e.fingerprint!==""&&await e.client.validate();return n.ok=t,t}async function It(n){const e=ue(),t=V();return t.fingerprint=(await at()).visitorId,await new S(se,n,t.fingerprint).validate()?(e.ok=!0,t.pass=n,!0):!1}const ce="EnterHome";const st={style:{"font-weight":"bold"}},rt=C({setup(n){const e=we(),t=be(),s=y(!1);$e(ce,s),ie().then(a=>s.value=a);const o=R(()=>e.name==="Login"),r=y(!1),i=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u6240\u6709",icon:"orders-o"},{text:"\u5173\u4E8E",icon:"info-o"}],_=a=>{a.text===i[0].text?t.push({name:"Home"}):a.text===i[1].text?t.push({name:"Account"}):a.text===i[2].text&&t.push({name:"About"})};return(a,h)=>{const b=g("router-view");return f(),E($,null,[!l(o)&&s.value?(f(),w(l(xe),{key:0,fixed:"",placeholder:""},{title:c(()=>[d("span",st,k(l(I)),1)]),right:c(()=>[u(l(Ee),{show:r.value,"onUpdate:show":h[0]||(h[0]=x=>r.value=x),actions:i,onSelect:_,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:c(()=>[u(l(ke),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):Y("",!0),u(b,{id:"main-view",h:"full"})],64)}}});const U=N("account",{state(){return{accounts:[]}},actions:{async init(){const e=await V().client.list();this.accounts=e},async push(n){const t=await V().client.create({amount:n.amount,category:n.category,tags:n.tags,description:n.description});this.accounts.push(t)},async update(n,e){const s=await V().client.update(n,e),o=this.accounts.findIndex(r=>r.timestamp===n);return o!==-1&&(this.accounts.splice(o,1),this.accounts.push(s),this.accounts.sort((r,i)=>r.timestamp.localeCompare(i.timestamp))),s},async delete(n){const t=await V().client.delete(n.timestamp);if(t){const s=this.accounts.findIndex(o=>o.timestamp===n.timestamp);return s!==-1&&this.accounts.splice(s,1),t}else return!1}},persist:!0}),lt={flex:"",justify:"between"},ut=d("span",null,"\u6807\u7B7E",-1),it={px:"4",pb:"8"},ct={flex:"",items:"center"},de=C({props:{modelValue:null},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,{modelValue:s}=Ce(t),o=y(!1),r=y([]);Fe(()=>{r.value=[]});const i=_=>{r.value[_].toggle()};return(_,a)=>{const h=g("Tag"),b=g("van-cell"),x=g("van-cell-group");return f(),E($,null,[u(b,{clickable:"",onClick:a[0]||(a[0]=p=>o.value=!0)},{default:c(()=>[d("div",lt,[ut,d("span",null,[(f(!0),E($,null,D(l(s),p=>(f(),w(h,{ml:"1",tag:p},null,8,["tag"]))),256))])])]),_:1}),u(l(ee),{show:o.value,"onUpdate:show":a[3]||(a[3]=p=>o.value=p),title:"\u6807\u7B7E",duration:.2,"overlay-style":{background:"rgba(0, 0, 0, .1)"}},{default:c(()=>[d("div",it,[u(l(Se),{"model-value":l(s),"onUpdate:modelValue":a[2]||(a[2]=p=>e("update:modelValue",p))},{default:c(()=>[u(x,null,{default:c(()=>[(f(!0),E($,null,D(l(re),(p,m)=>(f(),w(b,{clickable:"",key:p.name,onClick:B=>i(m)},{"right-icon":c(()=>[u(l(Ve),{name:p.name,ref_for:!0,ref:B=>r.value[m]=B,onClick:a[1]||(a[1]=Z(()=>{},["stop"])),shape:"square"},null,8,["name"])]),default:c(()=>[d("div",ct,[d("span",{h:"4",w:"4",mr:"2","inline-block":"",rounded:"full",style:De({background:p.color})},null,4),d("span",null,k(p.name),1)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["model-value"])])]),_:1},8,["show","duration","overlay-style"])],64)}}}),dt={px:"4",pb:"8"},pt={flex:"",justify:"between"},mt=d("span",null,"\u91D1\u989D",-1),ft={flex:"",justify:"between"},_t=d("span",null,"\u5206\u7C7B",-1),vt={flex:"",justify:"between"},gt=d("span",null,"\u65F6\u95F4",-1),ht={mt:"4",text:"right"},yt=L("\u4FDD\u5B58"),wt=L("\u5220\u9664"),bt=C({props:{account:null},setup(n){const e=n,t=y(e.account);Le(()=>e.account,_=>{t.value=W({},_)});const s=R({get(){return!!t.value},set(){t.value=void 0}}),o=U(),r=async()=>{t.value&&(await o.update(e.account.timestamp,t.value),t.value=void 0,A({message:"\u66F4\u65B0\u6210\u529F",type:"success"}))},i=async()=>{t.value&&(await o.delete(t.value),t.value=void 0,A({message:"\u5220\u9664\u6210\u529F",type:"success"}))};return(_,a)=>{const h=g("van-cell"),b=g("Category"),x=g("van-cell-group"),p=g("van-button");return f(),w(l(ee),{show:l(s),"onUpdate:show":a[4]||(a[4]=m=>Be(s)?s.value=m:null),title:t.value&&l(T)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"rgba(0, 0, 0, .1)"}},{default:c(()=>[d("div",dt,[t.value?(f(),w(x,{key:0},{default:c(()=>[u(h,null,{default:c(()=>[d("div",pt,[mt,d("span",null,"\uFFE5 "+k(t.value.amount),1)])]),_:1}),u(h,null,{default:c(()=>[d("div",ft,[_t,u(b,{category:t.value.category},null,8,["category"])])]),_:1}),u(de,{modelValue:t.value.tags,"onUpdate:modelValue":a[0]||(a[0]=m=>t.value.tags=m)},null,8,["modelValue"]),u(h,null,{default:c(()=>[d("div",vt,[gt,d("span",null,k(l(T)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm:ss")),1)])]),_:1}),u(l(te),{modelValue:t.value.description,"onUpdate:modelValue":a[1]||(a[1]=m=>t.value.description=m),rows:"2",autosize:"",label:"\u5907\u6CE8",type:"textarea",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})):Y("",!0),d("div",ht,[u(p,{round:"",icon:"guide-o",type:"success",mr:"4",onClick:a[2]||(a[2]=m=>r())},{default:c(()=>[yt]),_:1}),u(p,{round:"",icon:"delete",type:"danger",onClick:a[3]||(a[3]=m=>i())},{default:c(()=>[wt]),_:1})])])]),_:1},8,["show","title","duration","overlay-style"])}}});const kt={flex:"",justify:"between",items:"center"},Et={"inline-block":"",mr:"2",text:"gray-400"},xt=C({setup(n){const e=U();e.init();const t=y();return(s,o)=>{const r=g("Category"),i=g("van-cell"),_=g("van-cell-group");return f(),w(_,{inset:""},{default:c(()=>[u(l(Pe),null,{default:c(()=>[(f(!0),E($,null,D(l(e).accounts.slice().reverse(),a=>(f(),w(i,{key:a.timestamp,clickable:"",onClick:h=>t.value=a},{default:c(()=>[d("div",kt,[d("span",null,[d("span",Et,k(l(T)(new Date(a.timestamp),"yyyy-MM-dd hh:mm")),1),u(r,{category:a.category},null,8,["category"])]),d("span",null,"\uFFE5 "+k(a.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),u(bt,{account:t.value},null,8,["account"])]),_:1})}}});const $t={id:"home",h:"full",pt:"4"},Ct={flex:"",justify:"between"},Ft=d("span",null,"\u5206\u7C7B",-1),St={flex:"","flex-col":"",items:"center",justify:"center"},Vt={h:"full",w:"full"},Dt={class:"van-grid-item__text",mt:"2"},Lt={style:{margin:"16px"}},Bt=L("\u8BB0\u5F55"),Pt=C({setup(n){Oe(ce).value=!0;const e=U(),t=y(),s=y(!1),o=y(),r=y(""),i=p=>(r.value="",/\d+\.\d\d\d+$/.test(p)?Number.parseFloat(p).toFixed(2):p),_=y(P.length>0?P[0].name:""),a=y([]),h=y(""),b=p=>{_.value=p.category,p.amount&&(o.value=String(p.amount)),p.tags&&(a.value=p.tags),p.description&&(h.value="")},x=async()=>{if(!o.value||o.value===""){r.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await e.push({amount:+o.value,category:_.value,tags:a.value,description:h.value}),A({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",a.value=[],h.value=""};return(p,m)=>{const B=g("Category"),me=g("van-image"),fe=g("van-button");return f(),E("div",$t,[u(l(ne),{inset:""},{default:c(()=>[u(l(te),{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=v=>o.value=v),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:i,maxlength:10,"error-message":r.value,"error-message-align":"right",onTouchstart:m[1]||(m[1]=Z(v=>s.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),u(l(j),null,{default:c(()=>[d("div",Ct,[Ft,u(B,{category:_.value},null,8,["category"])])]),_:1}),u(de,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=v=>a.value=v)},null,8,["modelValue"]),u(l(j),null,{default:c(()=>[u(l(Re),{active:t.value,"onUpdate:active":m[3]||(m[3]=v=>t.value=v)},{default:c(()=>[(f(!0),E($,null,D(l(P),v=>(f(),w(l(Ie),{key:v.name,title:v.name},{default:c(()=>[u(l(Ae),{border:!1,clickable:""},{default:c(()=>[u(l(G),{icon:"success",text:"\u4F7F\u7528",onClick:F=>b({category:v.name})},null,8,["onClick"]),(f(!0),E($,null,D(l(Je).filter(F=>F.category===v.name),F=>(f(),w(l(G),{onClick:Tt=>b(F)},{default:c(()=>[d("div",St,[u(me,{src:F.icon,height:"50%",width:"50%"},{loading:c(()=>[d("div",Vt,[u(l(je),{type:"spinner",size:"20"})])]),_:2},1032,["src"]),d("span",Dt,k(F.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),d("div",Lt,[u(fe,{round:"",block:"",type:"success",onClick:x},{default:c(()=>[Bt]),_:1})]),u(xt),u(l(Te),{modelValue:o.value,"onUpdate:modelValue":m[4]||(m[4]=v=>o.value=v),"extra-key":".",show:s.value,maxlength:10,onBlur:m[5]||(m[5]=v=>s.value=!1)},null,8,["modelValue","show"])])}}}),H=Ne({history:Ue(),routes:[{path:"/",name:"Home",component:Pt},{path:"/account",name:"Account",component:()=>O(()=>import("./index.7a597ec2.js"),["assets/index.7a597ec2.js","assets/index.97d966c7.css","assets/vendor.0089f223.js","assets/vendor.b848d3cd.css"])},{path:"/login",name:"Login",component:()=>O(()=>import("./Login.ecfffedc.js"),["assets/Login.ecfffedc.js","assets/Login.79953f6d.css","assets/vendor.0089f223.js","assets/vendor.b848d3cd.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>O(()=>import("./About.8bcdb841.js"),["assets/About.8bcdb841.js","assets/About.1be23510.css","assets/vendor.0089f223.js","assets/vendor.b848d3cd.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(n,e,t){return t||{top:0}}});H.beforeEach(async n=>n.name==="Login"||await ie()?!0:{name:"Login"});H.beforeEach(n=>{n.meta.title?document.title=n.meta.title+" - "+I:document.title=I});const Ot=C({props:{tag:null},setup(n){const e=n,t=R(()=>{var s,o;return typeof e.tag=="string"?{name:e.tag,color:(o=(s=re.find(r=>r.name===e.tag))==null?void 0:s.color)!=null?o:"#F2F3F5"}:e.tag});return(s,o)=>(f(),w(l(ae),{color:l(t).color},{default:c(()=>[oe(s.$slots,"default",{},()=>[L(k(l(t).name),1)])]),_:3},8,["color"]))}}),Rt=C({props:{category:null},setup(n){const e=n,t=R(()=>{var s,o;return typeof e.category=="string"?{name:e.category,color:(o=(s=P.find(r=>r.name===e.category))==null?void 0:s.color)!=null?o:"#F2F3F5"}:e.category});return(s,o)=>(f(),w(l(ae),{color:l(t).color},{default:c(()=>[oe(s.$slots,"default",{},()=>[L(k(l(t).name),1)])]),_:3},8,["color"]))}});Ke({});const pe=He();pe.use(Me);ze(rt).component("Category",Rt).component("Tag",Ot).use(j).use(ne).use(We).use(Ge).use(H).use(pe).mount("#app");{document.addEventListener("gesturestart",function(e){e.preventDefault()}),document.addEventListener("dblclick",function(e){e.preventDefault()}),document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()});let n=0;document.addEventListener("touchend",function(e){const t=new Date().getTime();t-n<=300&&e.preventDefault(),n=t},!1)}export{xt as _,It as l,I as n};
