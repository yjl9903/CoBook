import{v as ae,a as re,d as T,b as A,r as y,c as G,o as m,e as x,u as a,f as b,w as i,N as ie,g as K,h as c,F as P,i as ue,j as le,p as ce,k as F,l,t as h,I as de,P as fe,m as C,L as pe,T as B,n as L,q as O,s as me,A as _e,x as q,y as ve,C as J,z as he,B as ge,D as ye,E as $,G as we,H as be,J as I,K as Ee,M as ke,O as xe,Q as Fe,R as Le,S as De,U as Pe,V as Se,W as Be}from"./vendor.557e188a.js";const Ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};Ce();function Oe(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:s,onRegistered:o,onRegisterError:r}=e;let u;const f=async(d=!0)=>{};return"serviceWorker"in navigator&&(u=new ae("/sw.js",{scope:"/",type:"classic"}),u.addEventListener("activated",d=>{d.isUpdate?window.location.reload():s==null||s()}),u.register({immediate:t}).then(d=>{o==null||o(d)}).catch(d=>{r==null||r(d)})),f}const j="Coin Book",Q="https://cobook-worker.yjl9903.workers.dev",Re=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Food","Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Food","Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Food","Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Drink"]}],R=[{name:"Food",color:"#F2F3F5"},{name:"Drink",color:"#F2F3F5"}];var $e=Object.defineProperty,je=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,M=(e,t,n)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))Te.call(t,n)&&M(e,n,t[n]);if(H)for(var n of H(t))Ae.call(t,n)&&M(e,n,t[n]);return e},z=(e,t)=>je(e,Ve(t)),k=class{constructor(e,t,n){this.errorHandler=[],this.fingerprint=n,this.api=re.create({baseURL:e,headers:{Authorization:t}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(e){const{data:t}=await this.api.post("/account",z(U({},e),{timestamp:new Date().getTime(),fingerprint:this.fingerprint}));if(k.isResponseError(t))throw await this.handleError(t),t;return t}async update(e,t){const{data:n}=await this.api.put("/account",z(U({},t),{timestamp:e,fingerprint:this.fingerprint}));if(k.isResponseError(n))throw await this.handleError(n),n;return n}async delete(e){const{data:t}=await this.api.delete(`/account/${e}`);return!k.isResponseError(t)}async list(){const{data:e}=await this.api.get("/accounts");if(k.isResponseError(e))throw await this.handleError(e),e;return e.accounts}static isResponseError(e){return!e||e.status==="ERROR"}onError(e){this.errorHandler.push(e)}async handleError(e){await Promise.all(this.errorHandler.map(t=>t(e)))}};const Ne="modulepreload",W={},Ie="/",V=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${Ie}${s}`,s in W)return;W[s]=!0;const o=s.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Ne,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((f,d)=>{u.addEventListener("load",f),u.addEventListener("error",d)})})).then(()=>t())};async function X(){return await(await(await V(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const He=X();async function Me(){try{return await He}catch{return await X()}}const D=T("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:e=>new k(Q,e.pass,e.fingerprint)},persist:!0}),Y=T("authorization/valid",{state:()=>({ok:!1})});async function Z(){const e=Y();if(e.ok)return!0;const t=D(),n=t.pass!==""&&t.fingerprint!==""&&await t.client.validate();return e.ok=n,n}async function ht(e){const t=Y(),n=D();return n.fingerprint=(await Me()).visitorId,await new k(Q,e,n.fingerprint).validate()?(t.ok=!0,n.pass=e,!0):!1}const ee="EnterHome";const Ue={style:{"font-weight":"bold"}},ze=A({setup(e){const t=ue(),n=le(),s=y(!1);ce(ee,s),Z().then(d=>s.value=d);const o=G(()=>t.name==="Login"),r=y(!1),u=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u5173\u4E8E",icon:"info-o"}],f=d=>{d.text===u[0].text?n.push({name:"Home"}):d.text===u[1].text&&n.push({name:"About"})};return(d,w)=>{const p=F("router-view");return m(),x(P,null,[!a(o)&&s.value?(m(),b(a(ie),{key:0,fixed:"",placeholder:""},{title:i(()=>[l("span",Ue,h(a(j)),1)]),right:i(()=>[c(a(fe),{show:r.value,"onUpdate:show":w[0]||(w[0]=S=>r.value=S),actions:u,onSelect:f,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:i(()=>[c(a(de),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):K("",!0),c(p,{id:"main-view",h:"full"})],64)}}}),te=T("account",{state(){return{accounts:[]}},actions:{async init(){const t=await D().client.list();this.accounts=t},async push(e){const n=await D().client.create({amount:e.amount,category:e.category,tags:e.tags,description:e.description});this.accounts.push(n)},async delete(e){const n=await D().client.delete(e.timestamp);if(n){const s=this.accounts.findIndex(o=>o.timestamp===e.timestamp);return s!==-1&&this.accounts.splice(s,1),n}else return!1}},persist:!0});const We={flex:"",justify:"between",items:"center"},Ge={"inline-block":"",mr:"2",text:"gray-400"},Ke={px:"4",pb:"8"},qe={flex:"",justify:"between"},Je=l("span",null,"\u91D1\u989D",-1),Qe={flex:"",justify:"between"},Xe=l("span",null,"\u5206\u7C7B",-1),Ye={flex:"",justify:"between"},Ze=l("span",null,"\u6807\u7B7E",-1),et={flex:"",justify:"between"},tt=l("span",null,"\u65F6\u95F4",-1),nt={flex:"",justify:"between"},ot=l("span",null,"\u5907\u6CE8",-1),st={mt:"4",text:"right"},at=L("\u5220\u9664"),rt=A({setup(e){const t=te();t.init();const n=y(),s=G({get(){return!!n.value},set(){n.value=void 0}}),o=async r=>{r&&(await t.delete(r),n.value=void 0,q({message:"\u5220\u9664\u6210\u529F",type:"success"}))};return(r,u)=>{const f=F("van-cell"),d=F("van-cell-group"),w=F("van-button");return m(),b(d,{inset:""},{default:i(()=>[c(a(pe),null,{default:i(()=>[(m(!0),x(P,null,C(a(t).accounts.slice().reverse(),p=>(m(),b(f,{key:p.timestamp,clickable:"",onClick:S=>n.value=p},{default:i(()=>[l("div",We,[l("span",null,[l("span",Ge,h(a(O)(new Date(p.timestamp),"yyyy-MM-dd hh:mm")),1),c(a(B),null,{default:i(()=>[L(h(p.category),1)]),_:2},1024)]),l("span",null,"\uFFE5 "+h(p.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),c(a(_e),{show:a(s),"onUpdate:show":u[1]||(u[1]=p=>me(s)?s.value=p:null),title:n.value&&a(O)(new Date(n.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"transparent"}},{default:i(()=>[l("div",Ke,[n.value?(m(),b(d,{key:0},{default:i(()=>[c(f,null,{default:i(()=>[l("div",qe,[Je,l("span",null,"\uFFE5 "+h(n.value.amount),1)])]),_:1}),c(f,null,{default:i(()=>[l("div",Qe,[Xe,c(a(B),null,{default:i(()=>[L(h(n.value.category),1)]),_:1})])]),_:1}),c(f,null,{default:i(()=>[l("div",Ye,[Ze,l("span",null,[(m(!0),x(P,null,C(n.value.tags,p=>(m(),b(a(B),{ml:"1"},{default:i(()=>[L(h(p),1)]),_:2},1024))),256))])])]),_:1}),c(f,null,{default:i(()=>[l("div",et,[tt,l("span",null,h(a(O)(new Date(n.value.timestamp),"yyyy-MM-dd hh:mm")),1)])]),_:1}),c(f,null,{default:i(()=>[l("div",nt,[ot,l("span",null,h(n.value.description),1)])]),_:1})]),_:1})):K("",!0),l("div",st,[c(w,{round:"",icon:"delete",type:"danger",onClick:u[0]||(u[0]=p=>o(n.value))},{default:i(()=>[at]),_:1})])])]),_:1},8,["show","title","duration"])]),_:1})}}});const it={id:"home",h:"full",pt:"4"},ut={flex:"",justify:"between"},lt=l("span",null,"\u5206\u7C7B",-1),ct={flex:"","flex-col":"",items:"center",justify:"center"},dt={class:"van-grid-item__text mt-2"},ft={style:{margin:"16px"}},pt=L("\u8BB0\u5F55"),mt=A({setup(e){ve(ee).value=!0;const t=te(),n=y(),s=y(!1),o=y(),r=y(""),u=v=>(r.value="",/\d+\.\d\d\d+$/.test(v)?Number.parseFloat(v).toFixed(2):v),f=y(R.length>0?R[0].name:""),d=y([]),w=y(""),p=v=>{f.value=v.category,v.amount&&(o.value=v.amount),v.tags&&(d.value=v.tags),v.description&&(w.value="")},S=async()=>{if(!o.value||o.value===""){r.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await t.push({amount:+o.value,category:f.value,tags:d.value,description:w.value}),q({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",d.value=[],w.value=""};return(v,g)=>{const oe=F("van-image"),se=F("van-button");return m(),x("div",it,[c(a(J),{inset:""},{default:i(()=>[c(a(ge),{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=_=>o.value=_),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:u,maxlength:10,"error-message":r.value,"error-message-align":"right",onTouchstart:g[1]||(g[1]=ye(_=>s.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),c(a($),null,{default:i(()=>[l("div",ut,[lt,c(a(B),null,{default:i(()=>[L(h(f.value),1)]),_:1})])]),_:1}),c(a($),null,{default:i(()=>[c(a(we),{active:n.value,"onUpdate:active":g[2]||(g[2]=_=>n.value=_)},{default:i(()=>[(m(!0),x(P,null,C(a(R),_=>(m(),b(a(ke),{key:_.name,title:_.name},{default:i(()=>[c(a(be),{border:!1,clickable:""},{default:i(()=>[c(a(I),{icon:"success",text:"\u4F7F\u7528",onClick:E=>p({category:_.name})},null,8,["onClick"]),(m(!0),x(P,null,C(a(Re).filter(E=>E.category===_.name),E=>(m(),b(a(I),{onClick:_t=>p(E)},{default:i(()=>[l("div",ct,[c(oe,{src:E.icon,height:"50%",width:"50%"},{loading:i(()=>[c(a(Ee),{type:"spinner",size:"20"})]),_:2},1032,["src"]),l("span",dt,h(E.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),l("div",ft,[c(se,{round:"",block:"",type:"success",onClick:S},{default:i(()=>[pt]),_:1})]),c(rt),c(a(he),{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=_=>o.value=_),"extra-key":".",show:s.value,maxlength:10,onBlur:g[4]||(g[4]=_=>s.value=!1)},null,8,["modelValue","show"])])}}}),N=xe({history:Fe(),routes:[{path:"/",name:"Home",component:mt},{path:"/login",name:"Login",component:()=>V(()=>import("./Login.55cfe42c.js"),["assets/Login.55cfe42c.js","assets/Login.79953f6d.css","assets/vendor.557e188a.js","assets/vendor.f72989cf.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>V(()=>import("./About.a23253d6.js"),["assets/About.a23253d6.js","assets/About.1be23510.css","assets/vendor.557e188a.js","assets/vendor.f72989cf.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(e,t,n){return n||{top:0}}});N.beforeEach(async e=>e.name==="Login"||await Z()?!0:{name:"Login"});N.beforeEach(e=>{e.meta.title?document.title=e.meta.title+" - "+j:document.title=j});Oe({});const ne=Le();ne.use(De);Pe(ze).use($).use(J).use(Se).use(Be).use(N).use(ne).mount("#app");{document.addEventListener("gesturestart",function(t){t.preventDefault()}),document.addEventListener("dblclick",function(t){t.preventDefault()}),document.addEventListener("touchstart",function(t){t.touches.length>1&&t.preventDefault()});let e=0;document.addEventListener("touchend",function(t){const n=new Date().getTime();n-e<=300&&t.preventDefault(),e=n},!1)}export{ht as l,j as n};
