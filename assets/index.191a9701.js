import{v as ne,a as oe,d as T,b as N,r as y,c as z,o as p,e as k,u as s,f as w,w as a,N as se,g as W,h as c,F as L,i as re,j as ae,p as ie,k as E,l,t as h,I as ue,P as le,m as P,L as ce,T as D,n as x,q as C,s as de,A as fe,x as pe,C as G,y as me,z as _e,B as ve,D as he,E as $,G as ge,H as ye,J as I,K as we,M as be,O as ke,Q as Ee,R as xe,S as Fe,U as Le,V as De,W as Pe}from"./vendor.ed4e013d.js";const Be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerpolicy&&(u.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?u.credentials="include":o.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}};Be();function Oe(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:i,onRegistered:o,onRegisterError:u}=e;let r;const m=async(d=!0)=>{};return"serviceWorker"in navigator&&(r=new ne("/sw.js",{scope:"/",type:"classic"}),r.addEventListener("activated",d=>{d.isUpdate?window.location.reload():i==null||i()}),r.register({immediate:t}).then(d=>{o==null||o(d)}).catch(d=>{u==null||u(d)})),m}const j="Coin Book",K="https://cobook-worker.yjl9903.workers.dev",Se=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Food","Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Food","Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Food","Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Drink"]}],R=[{name:"Food",color:"#F2F3F5"},{name:"Drink",color:"#F2F3F5"}];var Ce=Object.defineProperty,Re=Object.defineProperties,$e=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable,M=(e,t,n)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Te=(e,t)=>{for(var n in t||(t={}))je.call(t,n)&&M(e,n,t[n]);if(H)for(var n of H(t))Ve.call(t,n)&&M(e,n,t[n]);return e},Ne=(e,t)=>Re(e,$e(t)),B=class{constructor(e,t,n){this.errorHandler=[],this.fingerprint=n,this.api=oe.create({baseURL:e,headers:{Authorization:t}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(e){const{data:t}=await this.api.post("/account",Ne(Te({},e),{fingerprint:this.fingerprint,timestamp:new Date().getTime()}));if(B.isResponseError(t))throw await this.handleError(t),t;return t}async list(){const{data:e}=await this.api.get("/accounts");if(B.isResponseError(e))throw await this.handleError(e),e;return e.accounts}static isResponseError(e){return!e||e.status==="ERROR"}onError(e){this.errorHandler.push(e)}async handleError(e){await Promise.all(this.errorHandler.map(t=>t(e)))}};const Ae="modulepreload",U={},Ie="/",V=function(t,n){return!n||n.length===0?t():Promise.all(n.map(i=>{if(i=`${Ie}${i}`,i in U)return;U[i]=!0;const o=i.endsWith(".css"),u=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${u}`))return;const r=document.createElement("link");if(r.rel=o?"stylesheet":Ae,o||(r.as="script",r.crossOrigin=""),r.href=i,document.head.appendChild(r),o)return new Promise((m,d)=>{r.addEventListener("load",m),r.addEventListener("error",d)})})).then(()=>t())};async function q(){return await(await(await V(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const He=q();async function Me(){try{return await He}catch{return await q()}}const O=T("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:e=>new B(K,e.pass,e.fingerprint)},persist:!0}),J=T("authorization/valid",{state:()=>({ok:!1})});async function Q(){const e=J();if(e.ok)return!0;const t=O(),n=t.pass!==""&&t.fingerprint!==""&&await t.client.validate();return e.ok=n,n}async function ht(e){const t=J(),n=O();return n.fingerprint=(await Me()).visitorId,await new B(K,e,n.fingerprint).validate()?(t.ok=!0,n.pass=e,!0):!1}const X="EnterHome";const Ue={style:{"font-weight":"bold"}},ze=N({setup(e){const t=re(),n=ae(),i=y(!1);ie(X,i),Q().then(d=>i.value=d);const o=z(()=>t.name==="Login"),u=y(!1),r=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u5173\u4E8E",icon:"info-o"}],m=d=>{d.text===r[0].text?n.push({name:"Home"}):d.text===r[1].text&&n.push({name:"About"})};return(d,f)=>{const F=E("router-view");return p(),k(L,null,[!s(o)&&i.value?(p(),w(s(se),{key:0,fixed:"",placeholder:""},{title:a(()=>[l("span",Ue,h(s(j)),1)]),right:a(()=>[c(s(le),{show:u.value,"onUpdate:show":f[0]||(f[0]=S=>u.value=S),actions:r,onSelect:m,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:a(()=>[c(s(ue),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):W("",!0),c(F,{id:"main-view",h:"full"})],64)}}}),Y=T("account",{state(){return{accounts:[]}},actions:{async init(){const t=await O().client.list();this.accounts=t},async push(e){const n=await O().client.create({amount:e.amount,category:e.category,tags:e.tags,description:e.description});this.accounts.push(n)}},persist:!0});const We={flex:"",justify:"between",items:"center"},Ge={"inline-block":"",mr:"2",text:"gray-400"},Ke={px:"4",pb:"8"},qe={flex:"",justify:"between"},Je=l("span",null,"\u91D1\u989D",-1),Qe={flex:"",justify:"between"},Xe=l("span",null,"\u5206\u7C7B",-1),Ye={flex:"",justify:"between"},Ze=l("span",null,"\u6807\u7B7E",-1),et={flex:"",justify:"between"},tt=l("span",null,"\u65F6\u95F4",-1),nt={flex:"",justify:"between"},ot=l("span",null,"\u5907\u6CE8",-1),st={mt:"4",text:"right"},rt=x("\u5220\u9664"),at=N({setup(e){const t=Y();t.init();const n=y(),i=z({get(){return!!n.value},set(){n.value=void 0}});return(o,u)=>{const r=E("van-cell"),m=E("van-cell-group"),d=E("van-button");return p(),w(m,{inset:""},{default:a(()=>[c(s(ce),null,{default:a(()=>[(p(!0),k(L,null,P(s(t).accounts.slice().reverse(),f=>(p(),w(r,{key:f.timestamp,clickable:"",onClick:F=>n.value=f},{default:a(()=>[l("div",We,[l("span",null,[l("span",Ge,h(s(C)(new Date(f.timestamp),"yyyy-MM-dd hh:mm")),1),c(s(D),null,{default:a(()=>[x(h(f.category),1)]),_:2},1024)]),l("span",null,"\uFFE5 "+h(f.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),c(s(fe),{show:s(i),"onUpdate:show":u[0]||(u[0]=f=>de(i)?i.value=f:null),title:n.value&&s(C)(new Date(n.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"transparent"}},{default:a(()=>[l("div",Ke,[n.value?(p(),w(m,{key:0},{default:a(()=>[c(r,null,{default:a(()=>[l("div",qe,[Je,l("span",null,"\uFFE5 "+h(n.value.amount),1)])]),_:1}),c(r,null,{default:a(()=>[l("div",Qe,[Xe,c(s(D),null,{default:a(()=>[x(h(n.value.category),1)]),_:1})])]),_:1}),c(r,null,{default:a(()=>[l("div",Ye,[Ze,l("span",null,[(p(!0),k(L,null,P(n.value.tags,f=>(p(),w(s(D),{ml:"1"},{default:a(()=>[x(h(f),1)]),_:2},1024))),256))])])]),_:1}),c(r,null,{default:a(()=>[l("div",et,[tt,l("span",null,h(s(C)(new Date(n.value.timestamp),"yyyy-MM-dd hh:mm")),1)])]),_:1}),c(r,null,{default:a(()=>[l("div",nt,[ot,l("span",null,h(n.value.description),1)])]),_:1})]),_:1})):W("",!0),l("div",st,[c(d,{round:"",icon:"delete",type:"danger"},{default:a(()=>[rt]),_:1})])])]),_:1},8,["show","title","duration"])]),_:1})}}});const it={id:"home",h:"full",pt:"4"},ut={flex:"",justify:"between"},lt=l("span",null,"\u5206\u7C7B",-1),ct={flex:"","flex-col":"",items:"center",justify:"center"},dt={class:"van-grid-item__text mt-2"},ft={style:{margin:"16px"}},pt=x("\u8BB0\u5F55"),mt=N({setup(e){pe(X).value=!0;const t=Y(),n=y(),i=y(!1),o=y(),u=y(""),r=v=>(u.value="",/\d+\.\d\d\d+$/.test(v)?Number.parseFloat(v).toFixed(2):v),m=y(R.length>0?R[0].name:""),d=y([]),f=y(""),F=v=>{m.value=v.category,v.amount&&(o.value=v.amount),v.tags&&(d.value=v.tags),v.description&&(f.value="")},S=async()=>{if(!o.value||o.value===""){u.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await t.push({amount:+o.value,category:m.value,tags:d.value,description:f.value}),_e({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",d.value=[],f.value=""};return(v,g)=>{const ee=E("van-image"),te=E("van-button");return p(),k("div",it,[c(s(G),{inset:""},{default:a(()=>[c(s(ve),{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=_=>o.value=_),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:r,maxlength:10,"error-message":u.value,"error-message-align":"right",onTouchstart:g[1]||(g[1]=he(_=>i.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),c(s($),null,{default:a(()=>[l("div",ut,[lt,c(s(D),null,{default:a(()=>[x(h(m.value),1)]),_:1})])]),_:1}),c(s($),null,{default:a(()=>[c(s(ge),{active:n.value,"onUpdate:active":g[2]||(g[2]=_=>n.value=_)},{default:a(()=>[(p(!0),k(L,null,P(s(R),_=>(p(),w(s(be),{key:_.name,title:_.name},{default:a(()=>[c(s(ye),{border:!1,clickable:""},{default:a(()=>[c(s(I),{icon:"success",text:"\u4F7F\u7528",onClick:b=>F({category:_.name})},null,8,["onClick"]),(p(!0),k(L,null,P(s(Se).filter(b=>b.category===_.name),b=>(p(),w(s(I),{onClick:_t=>F(b)},{default:a(()=>[l("div",ct,[c(ee,{src:b.icon,height:"50%",width:"50%"},{loading:a(()=>[c(s(we),{type:"spinner",size:"20"})]),_:2},1032,["src"]),l("span",dt,h(b.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),l("div",ft,[c(te,{round:"",block:"",type:"success",onClick:S},{default:a(()=>[pt]),_:1})]),c(at),c(s(me),{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=_=>o.value=_),"extra-key":".",show:i.value,maxlength:10,onBlur:g[4]||(g[4]=_=>i.value=!1)},null,8,["modelValue","show"])])}}}),A=ke({history:Ee(),routes:[{path:"/",name:"Home",component:mt},{path:"/login",name:"Login",component:()=>V(()=>import("./Login.41cf01b5.js"),["assets/Login.41cf01b5.js","assets/Login.79953f6d.css","assets/vendor.ed4e013d.js","assets/vendor.f72989cf.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>V(()=>import("./About.a0b0fa60.js"),["assets/About.a0b0fa60.js","assets/About.1be23510.css","assets/vendor.ed4e013d.js","assets/vendor.f72989cf.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(e,t,n){return n||{top:0}}});A.beforeEach(async e=>e.name==="Login"||await Q()?!0:{name:"Login"});A.beforeEach(e=>{e.meta.title?document.title=e.meta.title+" - "+j:document.title=j});Oe({});const Z=xe();Z.use(Fe);Le(ze).use($).use(G).use(De).use(Pe).use(A).use(Z).mount("#app");{document.addEventListener("gesturestart",function(t){t.preventDefault()}),document.addEventListener("dblclick",function(t){t.preventDefault()}),document.addEventListener("touchstart",function(t){t.touches.length>1&&t.preventDefault()});let e=0;document.addEventListener("touchend",function(t){const n=new Date().getTime();n-e<=300&&t.preventDefault(),e=n},!1)}export{ht as l,j as n};
