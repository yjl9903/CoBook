import{v as ue,a as le,d as j,b as $,u as ce,c as de,r as v,e as O,f as h,o as p,g as F,h as r,i as y,w as d,j as f,t as b,k as u,I as fe,P as pe,N as me,l as G,F as C,p as _e,m as B,n as V,L as ge,q as K,s as ve,A as he,x as R,y as q,z as ye,B as we,C as T,T as be,D as J,E as Ee,G as ke,H as I,J as xe,K as Fe,M as De,O as Le,Q,R as X,S as Ce,U as $e,V as Pe,W as Se,X as Be}from"./vendor.eb5f3fd3.js";const Oe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}};Oe();function Re(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:o,onRegisterError:s}=n;let i;const m=async(l=!0)=>{};return"serviceWorker"in navigator&&(i=new ue("/sw.js",{scope:"/",type:"classic"}),i.addEventListener("activated",l=>{l.isUpdate?window.location.reload():a==null||a()}),i.register({immediate:e}).then(l=>{o==null||o(l)}).catch(l=>{s==null||s(l)})),m}const A="Coin Book",Y="https://cobook-worker.yjl9903.workers.dev",Ve=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Food","Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Food","Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Food","Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Drink"]}],Te=[{name:"Food",color:"#c4b5fd"},{name:"Drink",color:"#fca5a5"},{name:"Breakfast",color:"#86efac"},{name:"Lunch",color:"#d8b4fe"},{name:"Dinner",color:"#fdba74"}],P=[{name:"Food",color:"#cbd5e1"},{name:"Drink",color:"#a5b4fc"}];var Ae=Object.defineProperty,je=Object.defineProperties,Ne=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,M=(n,e,t)=>e in n?Ae(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))Ie.call(e,t)&&M(n,t,e[t]);if(H)for(var t of H(e))He.call(e,t)&&M(n,t,e[t]);return n},z=(n,e)=>je(n,Ne(e)),x=class{constructor(n,e,t){this.errorHandler=[],this.fingerprint=t,this.api=le.create({baseURL:n,headers:{Authorization:e}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(n){const{data:e}=await this.api.post("/account",z(U({},n),{timestamp:new Date().getTime(),fingerprint:this.fingerprint}));if(x.isResponseError(e))throw await this.handleError(e),e;return e}async update(n,e){const{data:t}=await this.api.put(`/account/${n}`,z(U({},e),{fingerprint:this.fingerprint}));if(x.isResponseError(t))throw await this.handleError(t),t;return t}async delete(n){const{data:e}=await this.api.delete(`/account/${n}`);return!x.isResponseError(e)}async list(){const{data:n}=await this.api.get("/accounts");if(x.isResponseError(n))throw await this.handleError(n),n;return n.accounts}static isResponseError(n){return!n||n.status==="ERROR"}onError(n){this.errorHandler.push(n)}async handleError(n){await Promise.all(this.errorHandler.map(e=>e(n)))}};const Me="modulepreload",W={},Ue="/",S=function(e,t){return!t||t.length===0?e():Promise.all(t.map(a=>{if(a=`${Ue}${a}`,a in W)return;W[a]=!0;const o=a.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${s}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":Me,o||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),o)return new Promise((m,l)=>{i.addEventListener("load",m),i.addEventListener("error",l)})})).then(()=>e())};async function Z(){return await(await(await S(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const ze=Z();async function We(){try{return await ze}catch{return await Z()}}const L=j("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:n=>new x(Y,n.pass,n.fingerprint)},persist:!0}),ee=j("authorization/valid",{state:()=>({ok:!1})});async function te(){const n=ee();if(n.ok)return!0;const e=L(),t=e.pass!==""&&e.fingerprint!==""&&await e.client.validate();return n.ok=t,t}async function wt(n){const e=ee(),t=L();return t.fingerprint=(await We()).visitorId,await new x(Y,n,t.fingerprint).validate()?(e.ok=!0,t.pass=n,!0):!1}const ne="EnterHome";const Ge={style:{"font-weight":"bold"}},Ke=$({setup(n){const e=ce(),t=de(),a=v(!1);_e(ne,a),te().then(l=>a.value=l);const o=O(()=>e.name==="Login"),s=v(!1),i=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u6240\u6709",icon:"orders-o"},{text:"\u5173\u4E8E",icon:"info-o"}],m=l=>{l.text===i[0].text?t.push({name:"Home"}):l.text===i[1].text?t.push({name:"Account"}):l.text===i[2].text&&t.push({name:"About"})};return(l,w)=>{const E=h("router-view");return p(),F(C,null,[!r(o)&&a.value?(p(),y(r(me),{key:0,fixed:"",placeholder:""},{title:d(()=>[f("span",Ge,b(r(A)),1)]),right:d(()=>[u(r(pe),{show:s.value,"onUpdate:show":w[0]||(w[0]=D=>s.value=D),actions:i,onSelect:m,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:d(()=>[u(r(fe),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):G("",!0),u(E,{id:"main-view",h:"full"})],64)}}}),oe=j("account",{state(){return{accounts:[]}},actions:{async init(){const e=await L().client.list();this.accounts=e},async push(n){const t=await L().client.create({amount:n.amount,category:n.category,tags:n.tags,description:n.description});this.accounts.push(t)},async delete(n){const t=await L().client.delete(n.timestamp);if(t){const a=this.accounts.findIndex(o=>o.timestamp===n.timestamp);return a!==-1&&this.accounts.splice(a,1),t}else return!1}},persist:!0});const qe={flex:"",justify:"between",items:"center"},Je={"inline-block":"",mr:"2",text:"gray-400"},Qe={px:"4",pb:"8"},Xe={flex:"",justify:"between"},Ye=f("span",null,"\u91D1\u989D",-1),Ze={flex:"",justify:"between"},et=f("span",null,"\u5206\u7C7B",-1),tt={flex:"",justify:"between"},nt=f("span",null,"\u6807\u7B7E",-1),ot={flex:"",justify:"between"},at=f("span",null,"\u65F6\u95F4",-1),rt={mt:"4",text:"right"},st=R("\u5220\u9664"),it=$({setup(n){const e=oe();e.init();const t=v(),a=O({get(){return!!t.value},set(){t.value=void 0}}),o=async s=>{s&&(await e.delete(s),t.value=void 0,q({message:"\u5220\u9664\u6210\u529F",type:"success"}))};return(s,i)=>{const m=h("Category"),l=h("van-cell"),w=h("Tag"),E=h("van-cell-group"),D=h("van-button");return p(),y(E,{inset:""},{default:d(()=>[u(r(ge),null,{default:d(()=>[(p(!0),F(C,null,B(r(e).accounts.slice().reverse(),c=>(p(),y(l,{key:c.timestamp,clickable:"",onClick:g=>t.value=c},{default:d(()=>[f("div",qe,[f("span",null,[f("span",Je,b(r(V)(new Date(c.timestamp),"yyyy-MM-dd hh:mm")),1),u(m,{category:c.category},null,8,["category"])]),f("span",null,"\uFFE5 "+b(c.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),u(r(he),{show:r(a),"onUpdate:show":i[2]||(i[2]=c=>ve(a)?a.value=c:null),title:t.value&&r(V)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"rgba(0, 0, 0, .1)"}},{default:d(()=>[f("div",Qe,[t.value?(p(),y(E,{key:0},{default:d(()=>[u(l,null,{default:d(()=>[f("div",Xe,[Ye,f("span",null,"\uFFE5 "+b(t.value.amount),1)])]),_:1}),u(l,null,{default:d(()=>[f("div",Ze,[et,u(m,{category:t.value.category},null,8,["category"])])]),_:1}),u(l,null,{default:d(()=>[f("div",tt,[nt,f("span",null,[(p(!0),F(C,null,B(t.value.tags,c=>(p(),y(w,{ml:"1",tag:c},null,8,["tag"]))),256))])])]),_:1}),u(l,null,{default:d(()=>[f("div",ot,[at,f("span",null,b(r(V)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm")),1)])]),_:1}),u(r(K),{modelValue:t.value.description,"onUpdate:modelValue":i[0]||(i[0]=c=>t.value.description=c),rows:"2",autosize:"",label:"\u5907\u6CE8",type:"textarea",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})):G("",!0),f("div",rt,[u(D,{round:"",icon:"delete",type:"danger",onClick:i[1]||(i[1]=c=>o(t.value))},{default:d(()=>[st]),_:1})])])]),_:1},8,["show","title","duration","overlay-style"])]),_:1})}}});const ut={id:"home",h:"full",pt:"4"},lt={flex:"",justify:"between"},ct=f("span",null,"\u5206\u7C7B",-1),dt={flex:"","flex-col":"",items:"center",justify:"center"},ft={class:"van-grid-item__text mt-2"},pt={style:{margin:"16px"}},mt=R("\u8BB0\u5F55"),_t=$({setup(n){ye(ne).value=!0;const e=oe(),t=v(),a=v(!1),o=v(),s=v(""),i=c=>(s.value="",/\d+\.\d\d\d+$/.test(c)?Number.parseFloat(c).toFixed(2):c),m=v(P.length>0?P[0].name:""),l=v([]),w=v(""),E=c=>{m.value=c.category,c.amount&&(o.value=c.amount),c.tags&&(l.value=c.tags),c.description&&(w.value="")},D=async()=>{if(!o.value||o.value===""){s.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await e.push({amount:+o.value,category:m.value,tags:l.value,description:w.value}),q({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",l.value=[],w.value=""};return(c,g)=>{const re=h("Category"),se=h("van-image"),ie=h("van-button");return p(),F("div",ut,[u(r(J),{inset:""},{default:d(()=>[u(r(K),{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=_=>o.value=_),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:i,maxlength:10,"error-message":s.value,"error-message-align":"right",onTouchstart:g[1]||(g[1]=we(_=>a.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),u(r(T),null,{default:d(()=>[f("div",lt,[ct,u(re,{category:m.value},null,8,["category"])])]),_:1}),u(r(T),null,{default:d(()=>[u(r(be),{active:t.value,"onUpdate:active":g[2]||(g[2]=_=>t.value=_)},{default:d(()=>[(p(!0),F(C,null,B(r(P),_=>(p(),y(r(Fe),{key:_.name,title:_.name},{default:d(()=>[u(r(ke),{border:!1,clickable:""},{default:d(()=>[u(r(I),{icon:"success",text:"\u4F7F\u7528",onClick:k=>E({category:_.name})},null,8,["onClick"]),(p(!0),F(C,null,B(r(Ve).filter(k=>k.category===_.name),k=>(p(),y(r(I),{onClick:ht=>E(k)},{default:d(()=>[f("div",dt,[u(se,{src:k.icon,height:"50%",width:"50%"},{loading:d(()=>[u(r(xe),{type:"spinner",size:"20"})]),_:2},1032,["src"]),f("span",ft,b(k.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),f("div",pt,[u(ie,{round:"",block:"",type:"success",onClick:D},{default:d(()=>[mt]),_:1})]),u(it),u(r(Ee),{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=_=>o.value=_),"extra-key":".",show:a.value,maxlength:10,onBlur:g[4]||(g[4]=_=>a.value=!1)},null,8,["modelValue","show"])])}}}),N=De({history:Le(),routes:[{path:"/",name:"Home",component:_t},{path:"/account",name:"Account",component:()=>S(()=>import("./index.9428db8b.js"),["assets/index.9428db8b.js","assets/index.97d966c7.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"])},{path:"/login",name:"Login",component:()=>S(()=>import("./Login.8c9258c6.js"),["assets/Login.8c9258c6.js","assets/Login.79953f6d.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>S(()=>import("./About.f8fa0e56.js"),["assets/About.f8fa0e56.js","assets/About.1be23510.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(n,e,t){return t||{top:0}}});N.beforeEach(async n=>n.name==="Login"||await te()?!0:{name:"Login"});N.beforeEach(n=>{n.meta.title?document.title=n.meta.title+" - "+A:document.title=A});const gt=$({props:{tag:null},setup(n){const e=n,t=O(()=>{var a,o;return typeof e.tag=="string"?{name:e.tag,color:(o=(a=Te.find(s=>s.name===e.tag))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.tag});return(a,o)=>(p(),y(r(X),{color:r(t).color},{default:d(()=>[Q(a.$slots,"default",{},()=>[R(b(r(t).name),1)])]),_:3},8,["color"]))}}),vt=$({props:{category:null},setup(n){const e=n,t=O(()=>{var a,o;return typeof e.category=="string"?{name:e.category,color:(o=(a=P.find(s=>s.name===e.category))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.category});return(a,o)=>(p(),y(r(X),{color:r(t).color},{default:d(()=>[Q(a.$slots,"default",{},()=>[R(b(r(t).name),1)])]),_:3},8,["color"]))}});Re({});const ae=Ce();ae.use($e);Pe(Ke).component("Category",vt).component("Tag",gt).use(T).use(J).use(Se).use(Be).use(N).use(ae).mount("#app");{document.addEventListener("gesturestart",function(e){e.preventDefault()}),document.addEventListener("dblclick",function(e){e.preventDefault()}),document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()});let n=0;document.addEventListener("touchend",function(e){const t=new Date().getTime();t-n<=300&&e.preventDefault(),n=t},!1)}export{it as _,wt as l,A as n};
