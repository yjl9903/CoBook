import{v as le,a as ce,d as j,b as S,u as de,c as fe,r as v,e as R,f as h,o as p,g as k,h as r,i as y,w as d,j as c,t as b,k as u,I as pe,P as me,N as _e,l as G,F as L,p as ge,m as $,n as V,L as ve,q as K,s as he,A as ye,x as T,y as q,z as we,B as be,C as B,T as Ee,D as J,E as ke,G as xe,H as I,J as Fe,K as Le,M as De,O as $e,Q,R as X,S as Ce,U as Se,V as Be,W as Pe,X as Oe}from"./vendor.eb5f3fd3.js";const Re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}};Re();function Te(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:o,onRegisterError:s}=n;let i;const _=async(l=!0)=>{};return"serviceWorker"in navigator&&(i=new le("/sw.js",{scope:"/",type:"classic"}),i.addEventListener("activated",l=>{l.isUpdate?window.location.reload():a==null||a()}),i.register({immediate:e}).then(l=>{o==null||o(l)}).catch(l=>{s==null||s(l)})),_}const A="Coin Book",Y="https://cobook-worker.yjl9903.workers.dev",Ve=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Tea"]}],Ae=[{name:"Food",color:"#f0abfc"},{name:"Drink",color:"#fdba74"},{name:"Breakfast",color:"#fca5a5"},{name:"Lunch",color:"#d6d3d1"},{name:"Dinner",color:"#86efac"},{name:"Tea",color:"#7dd3fc"}],P=[{name:"Food",color:"#cbd5e1"},{name:"Drink",color:"#6ee7b7"}];var je=Object.defineProperty,Ne=Object.defineProperties,Ie=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,M=(n,e,t)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))He.call(e,t)&&M(n,t,e[t]);if(H)for(var t of H(e))Me.call(e,t)&&M(n,t,e[t]);return n},z=(n,e)=>Ne(n,Ie(e)),F=class{constructor(n,e,t){this.errorHandler=[],this.fingerprint=t,this.api=ce.create({baseURL:n,headers:{Authorization:e}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(n){const{data:e}=await this.api.post("/account",z(U({},n),{timestamp:new Date().getTime(),fingerprint:this.fingerprint}));if(F.isResponseError(e))throw await this.handleError(e),e;return e}async update(n,e){const{data:t}=await this.api.put(`/account/${n}`,z(U({},e),{fingerprint:this.fingerprint}));if(F.isResponseError(t))throw await this.handleError(t),t;return t}async delete(n){const{data:e}=await this.api.delete(`/account/${n}`);return!F.isResponseError(e)}async list(){const{data:n}=await this.api.get("/accounts");if(F.isResponseError(n))throw await this.handleError(n),n;return n.accounts}static isResponseError(n){return!n||n.status==="ERROR"}onError(n){this.errorHandler.push(n)}async handleError(n){await Promise.all(this.errorHandler.map(e=>e(n)))}};const Ue="modulepreload",W={},ze="/",O=function(e,t){return!t||t.length===0?e():Promise.all(t.map(a=>{if(a=`${ze}${a}`,a in W)return;W[a]=!0;const o=a.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${s}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":Ue,o||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),o)return new Promise((_,l)=>{i.addEventListener("load",_),i.addEventListener("error",l)})})).then(()=>e())};async function Z(){return await(await(await O(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const We=Z();async function Ge(){try{return await We}catch{return await Z()}}const C=j("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:n=>new F(Y,n.pass,n.fingerprint)},persist:!0}),ee=j("authorization/valid",{state:()=>({ok:!1})});async function te(){const n=ee();if(n.ok)return!0;const e=C(),t=e.pass!==""&&e.fingerprint!==""&&await e.client.validate();return n.ok=t,t}async function kt(n){const e=ee(),t=C();return t.fingerprint=(await Ge()).visitorId,await new F(Y,n,t.fingerprint).validate()?(e.ok=!0,t.pass=n,!0):!1}const ne="EnterHome";const Ke={style:{"font-weight":"bold"}},qe=S({setup(n){const e=de(),t=fe(),a=v(!1);ge(ne,a),te().then(l=>a.value=l);const o=R(()=>e.name==="Login"),s=v(!1),i=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u6240\u6709",icon:"orders-o"},{text:"\u5173\u4E8E",icon:"info-o"}],_=l=>{l.text===i[0].text?t.push({name:"Home"}):l.text===i[1].text?t.push({name:"Account"}):l.text===i[2].text&&t.push({name:"About"})};return(l,w)=>{const E=h("router-view");return p(),k(L,null,[!r(o)&&a.value?(p(),y(r(_e),{key:0,fixed:"",placeholder:""},{title:d(()=>[c("span",Ke,b(r(A)),1)]),right:d(()=>[u(r(me),{show:s.value,"onUpdate:show":w[0]||(w[0]=D=>s.value=D),actions:i,onSelect:_,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:d(()=>[u(r(pe),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):G("",!0),u(E,{id:"main-view",h:"full"})],64)}}});const oe=j("account",{state(){return{accounts:[]}},actions:{async init(){const e=await C().client.list();this.accounts=e},async push(n){const t=await C().client.create({amount:n.amount,category:n.category,tags:n.tags,description:n.description});this.accounts.push(t)},async delete(n){const t=await C().client.delete(n.timestamp);if(t){const a=this.accounts.findIndex(o=>o.timestamp===n.timestamp);return a!==-1&&this.accounts.splice(a,1),t}else return!1}},persist:!0});const Je={flex:"",justify:"between",items:"center"},Qe={"inline-block":"",mr:"2",text:"gray-400"},Xe={px:"4",pb:"8"},Ye={flex:"",justify:"between"},Ze=c("span",null,"\u91D1\u989D",-1),et={flex:"",justify:"between"},tt=c("span",null,"\u5206\u7C7B",-1),nt={flex:"",justify:"between"},ot=c("span",null,"\u6807\u7B7E",-1),at={flex:"",justify:"between"},rt=c("span",null,"\u65F6\u95F4",-1),st={mt:"4",text:"right"},it=T("\u5220\u9664"),ut=S({setup(n){const e=oe();e.init();const t=v(),a=R({get(){return!!t.value},set(){t.value=void 0}}),o=async s=>{s&&(await e.delete(s),t.value=void 0,q({message:"\u5220\u9664\u6210\u529F",type:"success"}))};return(s,i)=>{const _=h("Category"),l=h("van-cell"),w=h("Tag"),E=h("van-cell-group"),D=h("van-button");return p(),y(E,{inset:""},{default:d(()=>[u(r(ve),null,{default:d(()=>[(p(!0),k(L,null,$(r(e).accounts.slice().reverse(),f=>(p(),y(l,{key:f.timestamp,clickable:"",onClick:g=>t.value=f},{default:d(()=>[c("div",Je,[c("span",null,[c("span",Qe,b(r(V)(new Date(f.timestamp),"yyyy-MM-dd hh:mm")),1),u(_,{category:f.category},null,8,["category"])]),c("span",null,"\uFFE5 "+b(f.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),u(r(ye),{show:r(a),"onUpdate:show":i[2]||(i[2]=f=>he(a)?a.value=f:null),title:t.value&&r(V)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"rgba(0, 0, 0, .1)"}},{default:d(()=>[c("div",Xe,[t.value?(p(),y(E,{key:0},{default:d(()=>[u(l,null,{default:d(()=>[c("div",Ye,[Ze,c("span",null,"\uFFE5 "+b(t.value.amount),1)])]),_:1}),u(l,null,{default:d(()=>[c("div",et,[tt,u(_,{category:t.value.category},null,8,["category"])])]),_:1}),u(l,null,{default:d(()=>[c("div",nt,[ot,c("span",null,[(p(!0),k(L,null,$(t.value.tags,f=>(p(),y(w,{ml:"1",tag:f},null,8,["tag"]))),256))])])]),_:1}),u(l,null,{default:d(()=>[c("div",at,[rt,c("span",null,b(r(V)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm")),1)])]),_:1}),u(r(K),{modelValue:t.value.description,"onUpdate:modelValue":i[0]||(i[0]=f=>t.value.description=f),rows:"2",autosize:"",label:"\u5907\u6CE8",type:"textarea",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})):G("",!0),c("div",st,[u(D,{round:"",icon:"delete",type:"danger",onClick:i[1]||(i[1]=f=>o(t.value))},{default:d(()=>[it]),_:1})])])]),_:1},8,["show","title","duration","overlay-style"])]),_:1})}}});const lt={id:"home",h:"full",pt:"4"},ct={flex:"",justify:"between"},dt=c("span",null,"\u5206\u7C7B",-1),ft={flex:"",justify:"between"},pt=c("span",null,"\u6807\u7B7E",-1),mt={flex:"","flex-col":"",items:"center",justify:"center"},_t={class:"van-grid-item__text mt-2"},gt={style:{margin:"16px"}},vt=T("\u8BB0\u5F55"),ht=S({setup(n){we(ne).value=!0;const e=oe(),t=v(),a=v(!1),o=v(),s=v(""),i=f=>(s.value="",/\d+\.\d\d\d+$/.test(f)?Number.parseFloat(f).toFixed(2):f),_=v(P.length>0?P[0].name:""),l=v([]),w=v(""),E=f=>{_.value=f.category,f.amount&&(o.value=String(f.amount)),f.tags&&(l.value=f.tags),f.description&&(w.value="")},D=async()=>{if(!o.value||o.value===""){s.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await e.push({amount:+o.value,category:_.value,tags:l.value,description:w.value}),q({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",l.value=[],w.value=""};return(f,g)=>{const re=h("Category"),se=h("Tag"),ie=h("van-image"),ue=h("van-button");return p(),k("div",lt,[u(r(J),{inset:""},{default:d(()=>[u(r(K),{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=m=>o.value=m),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:i,maxlength:10,"error-message":s.value,"error-message-align":"right",onTouchstart:g[1]||(g[1]=be(m=>a.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),u(r(B),null,{default:d(()=>[c("div",ct,[dt,u(re,{category:_.value},null,8,["category"])])]),_:1}),u(r(B),null,{default:d(()=>[c("div",ft,[pt,c("span",null,[(p(!0),k(L,null,$(l.value,m=>(p(),y(se,{ml:"1",tag:m},null,8,["tag"]))),256))])])]),_:1}),u(r(B),null,{default:d(()=>[u(r(Ee),{active:t.value,"onUpdate:active":g[2]||(g[2]=m=>t.value=m)},{default:d(()=>[(p(!0),k(L,null,$(r(P),m=>(p(),y(r(Le),{key:m.name,title:m.name},{default:d(()=>[u(r(xe),{border:!1,clickable:""},{default:d(()=>[u(r(I),{icon:"success",text:"\u4F7F\u7528",onClick:x=>E({category:m.name})},null,8,["onClick"]),(p(!0),k(L,null,$(r(Ve).filter(x=>x.category===m.name),x=>(p(),y(r(I),{onClick:bt=>E(x)},{default:d(()=>[c("div",mt,[u(ie,{src:x.icon,height:"50%",width:"50%"},{loading:d(()=>[u(r(Fe),{type:"spinner",size:"20"})]),_:2},1032,["src"]),c("span",_t,b(x.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),c("div",gt,[u(ue,{round:"",block:"",type:"success",onClick:D},{default:d(()=>[vt]),_:1})]),u(ut),u(r(ke),{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=m=>o.value=m),"extra-key":".",show:a.value,maxlength:10,onBlur:g[4]||(g[4]=m=>a.value=!1)},null,8,["modelValue","show"])])}}}),N=De({history:$e(),routes:[{path:"/",name:"Home",component:ht},{path:"/account",name:"Account",component:()=>O(()=>import("./index.8a4b9e66.js"),["assets/index.8a4b9e66.js","assets/index.97d966c7.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"])},{path:"/login",name:"Login",component:()=>O(()=>import("./Login.dd9291cd.js"),["assets/Login.dd9291cd.js","assets/Login.79953f6d.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>O(()=>import("./About.71d52435.js"),["assets/About.71d52435.js","assets/About.1be23510.css","assets/vendor.eb5f3fd3.js","assets/vendor.b7162192.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(n,e,t){return t||{top:0}}});N.beforeEach(async n=>n.name==="Login"||await te()?!0:{name:"Login"});N.beforeEach(n=>{n.meta.title?document.title=n.meta.title+" - "+A:document.title=A});const yt=S({props:{tag:null},setup(n){const e=n,t=R(()=>{var a,o;return typeof e.tag=="string"?{name:e.tag,color:(o=(a=Ae.find(s=>s.name===e.tag))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.tag});return(a,o)=>(p(),y(r(X),{color:r(t).color},{default:d(()=>[Q(a.$slots,"default",{},()=>[T(b(r(t).name),1)])]),_:3},8,["color"]))}}),wt=S({props:{category:null},setup(n){const e=n,t=R(()=>{var a,o;return typeof e.category=="string"?{name:e.category,color:(o=(a=P.find(s=>s.name===e.category))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.category});return(a,o)=>(p(),y(r(X),{color:r(t).color},{default:d(()=>[Q(a.$slots,"default",{},()=>[T(b(r(t).name),1)])]),_:3},8,["color"]))}});Te({});const ae=Ce();ae.use(Se);Be(qe).component("Category",wt).component("Tag",yt).use(B).use(J).use(Pe).use(Oe).use(N).use(ae).mount("#app");{document.addEventListener("gesturestart",function(e){e.preventDefault()}),document.addEventListener("dblclick",function(e){e.preventDefault()}),document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()});let n=0;document.addEventListener("touchend",function(e){const t=new Date().getTime();t-n<=300&&e.preventDefault(),n=t},!1)}export{ut as _,kt as l,A as n};
