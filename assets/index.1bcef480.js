import{v as M,a as q,d as D,b as S,r as _,c as J,o as f,e as v,u,f as y,w as c,N as K,g as Q,h as l,F as k,i as X,j as Y,k as b,l as p,t as g,I as Z,P as ee,m as L,L as te,n as ne,T as $,p as R,C as I,q as re,s as oe,x as ae,y as se,z as P,A as ie,G as ue,B as V,D as le,E as ce,H as de,J as fe,K as pe,M as me,O as he}from"./vendor.bfcca186.js";const _e=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};_e();function ve(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:i,onRegistered:r,onRegisterError:a}=e;let o;const m=async(s=!0)=>{};return"serviceWorker"in navigator&&(o=new M("/sw.js",{scope:"/",type:"classic"}),o.addEventListener("activated",s=>{s.isUpdate?window.location.reload():i==null||i()}),o.register({immediate:t}).then(s=>{r==null||r(s)}).catch(s=>{a==null||a(s)})),m}const O="Coin Book",j="https://cobook-worker.yjl9903.workers.dev",ge=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Food","Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Food","Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Food","Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Drink"]}],x=[{name:"Food",color:"#F2F3F5"},{name:"Drink",color:"#F2F3F5"}];var ye=Object.defineProperty,we=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,N=(e,t,n)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fe=(e,t)=>{for(var n in t||(t={}))be.call(t,n)&&N(e,n,t[n]);if(T)for(var n of T(t))Ee.call(t,n)&&N(e,n,t[n]);return e},xe=(e,t)=>we(e,ke(t)),E=class{constructor(e,t,n){this.errorHandler=[],this.fingerprint=n,this.api=q.create({baseURL:e,headers:{Authorization:t}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(e){const{data:t}=await this.api.post("/account",xe(Fe({},e),{fingerprint:this.fingerprint,timestamp:new Date().getTime()}));if(E.isResponseError(t))throw await this.handleError(t),t;return t}async list(){const{data:e}=await this.api.get("/accounts");if(E.isResponseError(e))throw await this.handleError(e),e;return e.accounts}static isResponseError(e){return!e||e.status==="ERROR"}onError(e){this.errorHandler.push(e)}async handleError(e){await Promise.all(this.errorHandler.map(t=>t(e)))}};const Le="modulepreload",A={},Pe="/",B=function(t,n){return!n||n.length===0?t():Promise.all(n.map(i=>{if(i=`${Pe}${i}`,i in A)return;A[i]=!0;const r=i.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${a}`))return;const o=document.createElement("link");if(o.rel=r?"stylesheet":Le,r||(o.as="script",o.crossOrigin=""),o.href=i,document.head.appendChild(o),r)return new Promise((m,s)=>{o.addEventListener("load",m),o.addEventListener("error",s)})})).then(()=>t())};async function H(){return await(await(await B(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const Oe=H();async function Be(){try{return await Oe}catch{return await H()}}const F=D("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:e=>new E(j,e.pass,e.fingerprint)},persist:!0}),U=D("authorization/valid",{state:()=>({ok:!1})});async function z(){const e=U();if(e.ok)return!0;const t=F(),n=t.pass!==""&&t.fingerprint!==""&&await t.client.validate();return e.ok=n,n}async function Ue(e){const t=U(),n=F();return n.fingerprint=(await Be()).visitorId,await new E(j,e,n.fingerprint).validate()?(t.ok=!0,n.pass=e,!0):!1}const De={style:{"font-weight":"bold"}},Se=S({setup(e){const t=X(),n=Y(),i=_(!1);z().then(s=>i.value=s);const r=J(()=>t.name==="Login"),a=_(!1),o=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u5173\u4E8E",icon:"info-o"}],m=s=>{s.text===o[0].text?n.push({name:"Home"}):s.text===o[1].text&&n.push({name:"About"})};return(s,w)=>{const d=b("router-view");return f(),v(k,null,[!u(r)&&i.value?(f(),y(u(K),{key:0,fixed:"",placeholder:""},{title:c(()=>[p("span",De,g(u(O)),1)]),right:c(()=>[l(u(ee),{show:a.value,"onUpdate:show":w[0]||(w[0]=h=>a.value=h),actions:o,onSelect:m,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:c(()=>[l(u(Z),{name:"ellipsis",color:"black"})]),_:1},8,["show"])]),_:1})):Q("",!0),l(d,{id:"main-view",h:"full"})],64)}}}),W=D("account",{state(){return{accounts:[]}},actions:{async init(){const t=await F().client.list();this.accounts=t},async push(e){const n=await F().client.create({amount:e.amount,category:e.category,tags:e.tags,description:e.description});this.accounts.push(n)}},persist:!0}),Re={flex:"",justify:"between",items:"center"},Ce={"inline-block":"",mr:"2",text:"gray-400"},Ve=S({setup(e){const t=W();return t.init(),(n,i)=>{const r=b("van-cell"),a=b("van-cell-group");return f(),y(a,{inset:""},{default:c(()=>[l(u(te),null,{default:c(()=>[(f(!0),v(k,null,L(u(t).accounts.slice().reverse(),o=>(f(),y(r,{key:o.timestamp},{default:c(()=>[p("div",Re,[p("span",null,[p("span",Ce,g(u(ne)(new Date(o.timestamp),"yyyy-MM-dd hh:mm")),1),l(u($),null,{default:c(()=>[R(g(o.category),1)]),_:2},1024)]),p("span",null,"\uFFE5 "+g(o.amount),1)])]),_:2},1024))),128))]),_:1})]),_:1})}}});const Te={id:"home",h:"full",pt:"4"},Ne={flex:"",justify:"between"},Ae=p("span",null,"\u5206\u7C7B",-1),$e={style:{margin:"16px"}},Ie=R("\u8BB0\u5F55"),je=S({setup(e){const t=W(),n=_(),i=_(!1),r=_(""),a=_(x.length>0?x[0].name:""),o=async()=>{await t.push({amount:+r.value,category:a.value,tags:[],description:""}),oe({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),r.value=""};return(m,s)=>{const w=b("van-button");return f(),v("div",Te,[l(u(I),{inset:""},{default:c(()=>[l(u(ae),{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=d=>r.value=d),label:"\u91D1\u989D",readonly:"",clickable:"",placeholder:"\uFFE5 0",onTouchstart:s[1]||(s[1]=se(d=>i.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue"]),l(u(P),null,{default:c(()=>[p("div",Ne,[Ae,l(u($),null,{default:c(()=>[R(g(a.value),1)]),_:1})])]),_:1}),l(u(P),null,{default:c(()=>[l(u(ie),{active:n.value,"onUpdate:active":s[2]||(s[2]=d=>n.value=d)},{default:c(()=>[(f(!0),v(k,null,L(u(x),d=>(f(),y(u(le),{key:d.name,title:d.name},{default:c(()=>[l(u(ue),{border:!1,clickable:""},{default:c(()=>[l(u(V),{icon:"success",text:"\u4F7F\u7528",onClick:h=>a.value=d.name},null,8,["onClick"]),(f(!0),v(k,null,L(u(ge).filter(h=>h.category===d.name),h=>(f(),y(u(V),{icon:"photo-o",text:h.name},null,8,["text"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),p("div",$e,[l(w,{round:"",block:"",type:"success",onClick:o},{default:c(()=>[Ie]),_:1})]),l(Ve),l(u(re),{modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=d=>r.value=d),"extra-key":".",show:i.value,maxlength:10,onBlur:s[4]||(s[4]=d=>i.value=!1)},null,8,["modelValue","show"])])}}}),C=ce({history:de(),routes:[{path:"/",name:"Home",component:je},{path:"/login",name:"Login",component:()=>B(()=>import("./Login.8c316185.js"),["assets/Login.8c316185.js","assets/Login.79953f6d.css","assets/vendor.bfcca186.js","assets/vendor.c79ef4d5.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>B(()=>import("./About.ccf903bc.js"),["assets/About.ccf903bc.js","assets/About.1be23510.css","assets/vendor.bfcca186.js","assets/vendor.c79ef4d5.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(e,t,n){return n||{top:0}}});C.beforeEach(async e=>e.name==="Login"||await z()?!0:{name:"Login"});C.beforeEach(e=>{e.meta.title?document.title=e.meta.title+" - "+O:document.title=O});ve({});const G=fe();G.use(pe);me(Se).use(P).use(I).use(he).use(C).use(G).mount("#app");{document.addEventListener("gesturestart",function(t){t.preventDefault()}),document.addEventListener("dblclick",function(t){t.preventDefault()}),document.addEventListener("touchstart",function(t){t.touches.length>1&&t.preventDefault()});let e=0;document.addEventListener("touchend",function(t){const n=new Date().getTime();n-e<=300&&t.preventDefault(),e=n},!1)}export{Ue as l,O as n};
