var pe=Object.defineProperty;var U=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var z=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W=(n,e)=>{for(var t in e||(e={}))me.call(e,t)&&z(n,t,e[t]);if(U)for(var t of U(e))fe.call(e,t)&&z(n,t,e[t]);return n};import{v as _e,a as ve,d as N,b as L,u as ge,c as he,r as y,e as V,f as g,o as p,g as k,h as i,i as w,w as c,j as d,t as E,k as l,I as ye,P as we,N as be,l as Y,F as D,p as Ee,m as ke,n as B,q as A,s as Z,x as xe,A as Fe,y as P,z as j,L as $e,B as Ce,C as De,D as O,T as Le,E as ee,G as Se,H as Be,J as G,K as Pe,M as Oe,O as Re,Q as Te,R as te,S as ne,U as Ve,V as Ae,W as je,X as Ie,Y as Ne}from"./vendor.ecf1a60c.js";const He=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}};He();function Me(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:a,onRegistered:o,onRegisterError:s}=n;let u;const m=async(r=!0)=>{};return"serviceWorker"in navigator&&(u=new _e("/sw.js",{scope:"/",type:"classic"}),u.addEventListener("activated",r=>{r.isUpdate?window.location.reload():a==null||a()}),u.register({immediate:e}).then(r=>{o==null||o(r)}).catch(r=>{s==null||s(r)})),m}const I="Coin Book",oe="https://cobook-worker.yjl9903.workers.dev",Ue=[{name:"Breakfast",icon:"/img/breakfast.svg",category:"Food",tags:["Breakfast"],amount:10},{name:"Lunch",icon:"/img/lunch.svg",category:"Food",tags:["Lunch"],amount:10},{name:"Dinner",icon:"/img/dinner.svg",category:"Food",tags:["Dinner"],amount:10},{name:"Tea",icon:"/img/tea.svg",category:"Drink",tags:["Tea"]}],ze=[{name:"Food",color:"#7dd3fc"},{name:"Drink",color:"#fde047"},{name:"Breakfast",color:"#cbd5e1"},{name:"Lunch",color:"#f9a8d4"},{name:"Dinner",color:"#6ee7b7"},{name:"Tea",color:"#fde047"}],R=[{name:"Food",color:"#a5b4fc"},{name:"Drink",color:"#fcd34d"}];var We=Object.defineProperty,Ge=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,q=(n,e,t)=>e in n?We(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,J=(n,e)=>{for(var t in e||(e={}))qe.call(e,t)&&q(n,t,e[t]);if(K)for(var t of K(e))Je.call(e,t)&&q(n,t,e[t]);return n},Q=(n,e)=>Ge(n,Ke(e)),$=class{constructor(n,e,t){this.errorHandler=[],this.fingerprint=t,this.api=ve.create({baseURL:n,headers:{Authorization:e}})}async validate(){try{return await this.api.get("/"),!0}catch{return!1}}async create(n){const{data:e}=await this.api.post("/account",Q(J({},n),{timestamp:new Date().getTime(),fingerprint:this.fingerprint}));if($.isResponseError(e))throw await this.handleError(e),e;return e}async update(n,e){const{data:t}=await this.api.put(`/account/${n}`,Q(J({},e),{fingerprint:this.fingerprint}));if($.isResponseError(t))throw await this.handleError(t),t;return t}async delete(n){const{data:e}=await this.api.delete(`/account/${n}`);return!$.isResponseError(e)}async list(){const{data:n}=await this.api.get("/accounts");if($.isResponseError(n))throw await this.handleError(n),n;return n.accounts}static isResponseError(n){return!n||n.status==="ERROR"}onError(n){this.errorHandler.push(n)}async handleError(n){await Promise.all(this.errorHandler.map(e=>e(n)))}};const Qe="modulepreload",X={},Xe="/",T=function(e,t){return!t||t.length===0?e():Promise.all(t.map(a=>{if(a=`${Xe}${a}`,a in X)return;X[a]=!0;const o=a.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${s}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Qe,o||(u.as="script",u.crossOrigin=""),u.href=a,document.head.appendChild(u),o)return new Promise((m,r)=>{u.addEventListener("load",m),u.addEventListener("error",r)})})).then(()=>e())};async function ae(){return await(await(await T(()=>import("./fp.esm.27f96b96.js"),[])).load()).get()}const Ye=ae();async function Ze(){try{return await Ye}catch{return await ae()}}const C=N("authorization",{state:()=>({fingerprint:"",pass:""}),getters:{client:n=>new $(oe,n.pass,n.fingerprint)},persist:!0}),se=N("authorization/valid",{state:()=>({ok:!1})});async function re(){const n=se();if(n.ok)return!0;const e=C(),t=e.pass!==""&&e.fingerprint!==""&&await e.client.validate();return n.ok=t,t}async function Ot(n){const e=se(),t=C();return t.fingerprint=(await Ze()).visitorId,await new $(oe,n,t.fingerprint).validate()?(e.ok=!0,t.pass=n,!0):!1}const ie="EnterHome";const et={style:{"font-weight":"bold"}},tt=L({setup(n){const e=ge(),t=he(),a=y(!1);Ee(ie,a),re().then(r=>a.value=r);const o=V(()=>e.name==="Login"),s=y(!1),u=[{text:"\u8BB0\u5F55",icon:"home-o"},{text:"\u6240\u6709",icon:"orders-o"},{text:"\u5173\u4E8E",icon:"info-o"}],m=r=>{r.text===u[0].text?t.push({name:"Home"}):r.text===u[1].text?t.push({name:"Account"}):r.text===u[2].text&&t.push({name:"About"})};return(r,h)=>{const x=g("router-view");return p(),k(D,null,[!i(o)&&a.value?(p(),w(i(be),{key:0,fixed:"",placeholder:""},{title:c(()=>[d("span",et,E(i(I)),1)]),right:c(()=>[l(i(we),{show:s.value,"onUpdate:show":h[0]||(h[0]=S=>s.value=S),actions:u,onSelect:m,placement:"bottom-end","show-arrow":!1,offset:[8,12]},{reference:c(()=>[l(i(ye),{name:"ellipsis",color:"black",mr:"1"})]),_:1},8,["show"])]),_:1})):Y("",!0),l(x,{id:"main-view",h:"full"})],64)}}});const H=N("account",{state(){return{accounts:[]}},actions:{async init(){const e=await C().client.list();this.accounts=e},async push(n){const t=await C().client.create({amount:n.amount,category:n.category,tags:n.tags,description:n.description});this.accounts.push(t)},async update(n,e){const a=await C().client.update(n,e),o=this.accounts.findIndex(s=>s.timestamp===n);return o!==-1&&(this.accounts.splice(o,1),this.accounts.push(a),this.accounts.sort((s,u)=>s.timestamp.localeCompare(u.timestamp))),a},async delete(n){const t=await C().client.delete(n.timestamp);if(t){const a=this.accounts.findIndex(o=>o.timestamp===n.timestamp);return a!==-1&&this.accounts.splice(a,1),t}else return!1}},persist:!0}),nt={px:"4",pb:"8"},ot={flex:"",justify:"between"},at=d("span",null,"\u91D1\u989D",-1),st={flex:"",justify:"between"},rt=d("span",null,"\u5206\u7C7B",-1),it={flex:"",justify:"between"},ut=d("span",null,"\u6807\u7B7E",-1),lt={flex:"",justify:"between"},ct=d("span",null,"\u65F6\u95F4",-1),dt={mt:"4",text:"right"},pt=P("\u4FDD\u5B58"),mt=P("\u5220\u9664"),ft=L({props:{account:null},setup(n){const e=n,t=y(e.account);ke(()=>e.account,m=>{t.value=W({},m)});const a=V({get(){return!!t.value},set(){t.value=void 0}}),o=H(),s=async()=>{t.value&&(await o.update(e.account.timestamp,t.value),t.value=void 0,j({message:"\u66F4\u65B0\u6210\u529F",type:"success"}))},u=async()=>{t.value&&(await o.delete(t.value),t.value=void 0,j({message:"\u5220\u9664\u6210\u529F",type:"success"}))};return(m,r)=>{const h=g("van-cell"),x=g("Category"),S=g("Tag"),_=g("van-cell-group"),v=g("van-button");return p(),w(i(Fe),{show:i(a),"onUpdate:show":r[3]||(r[3]=b=>xe(a)?a.value=b:null),title:t.value&&i(A)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm"),duration:.2,"overlay-style":{background:"rgba(0, 0, 0, .1)"}},{default:c(()=>[d("div",nt,[t.value?(p(),w(_,{key:0},{default:c(()=>[l(h,null,{default:c(()=>[d("div",ot,[at,d("span",null,"\uFFE5 "+E(t.value.amount),1)])]),_:1}),l(h,null,{default:c(()=>[d("div",st,[rt,l(x,{category:t.value.category},null,8,["category"])])]),_:1}),l(h,null,{default:c(()=>[d("div",it,[ut,d("span",null,[(p(!0),k(D,null,B(t.value.tags,b=>(p(),w(S,{ml:"1",tag:b},null,8,["tag"]))),256))])])]),_:1}),l(h,null,{default:c(()=>[d("div",lt,[ct,d("span",null,E(i(A)(new Date(t.value.timestamp),"yyyy-MM-dd hh:mm")),1)])]),_:1}),l(i(Z),{modelValue:t.value.description,"onUpdate:modelValue":r[0]||(r[0]=b=>t.value.description=b),rows:"2",autosize:"",label:"\u5907\u6CE8",type:"textarea",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})):Y("",!0),d("div",dt,[l(v,{round:"",icon:"guide-o",type:"success",mr:"4",onClick:r[1]||(r[1]=b=>s())},{default:c(()=>[pt]),_:1}),l(v,{round:"",icon:"delete",type:"danger",onClick:r[2]||(r[2]=b=>u())},{default:c(()=>[mt]),_:1})])])]),_:1},8,["show","title","duration","overlay-style"])}}});const _t={flex:"",justify:"between",items:"center"},vt={"inline-block":"",mr:"2",text:"gray-400"},gt=L({setup(n){const e=H();e.init();const t=y();return(a,o)=>{const s=g("Category"),u=g("van-cell"),m=g("van-cell-group");return p(),w(m,{inset:""},{default:c(()=>[l(i($e),null,{default:c(()=>[(p(!0),k(D,null,B(i(e).accounts.slice().reverse(),r=>(p(),w(u,{key:r.timestamp,clickable:"",onClick:h=>t.value=r},{default:c(()=>[d("div",_t,[d("span",null,[d("span",vt,E(i(A)(new Date(r.timestamp),"yyyy-MM-dd hh:mm")),1),l(s,{category:r.category},null,8,["category"])]),d("span",null,"\uFFE5 "+E(r.amount),1)])]),_:2},1032,["onClick"]))),128))]),_:1}),l(ft,{account:t.value},null,8,["account"])]),_:1})}}});const ht={id:"home",h:"full",pt:"4"},yt={flex:"",justify:"between"},wt=d("span",null,"\u5206\u7C7B",-1),bt={flex:"",justify:"between"},Et=d("span",null,"\u6807\u7B7E",-1),kt={flex:"","flex-col":"",items:"center",justify:"center"},xt={class:"van-grid-item__text mt-2"},Ft={style:{margin:"16px"}},$t=P("\u8BB0\u5F55"),Ct=L({setup(n){Ce(ie).value=!0;const e=H(),t=y(),a=y(!1),o=y(),s=y(""),u=_=>(s.value="",/\d+\.\d\d\d+$/.test(_)?Number.parseFloat(_).toFixed(2):_),m=y(R.length>0?R[0].name:""),r=y([]),h=y(""),x=_=>{m.value=_.category,_.amount&&(o.value=String(_.amount)),_.tags&&(r.value=_.tags),_.description&&(h.value="")},S=async()=>{if(!o.value||o.value===""){s.value="\u8BF7\u8F93\u5165\u91D1\u989D";return}await e.push({amount:+o.value,category:m.value,tags:r.value,description:h.value}),j({message:"\u8BB0\u5F55\u6210\u529F",type:"success"}),o.value="",r.value=[],h.value=""};return(_,v)=>{const b=g("Category"),le=g("Tag"),ce=g("van-image"),de=g("van-button");return p(),k("div",ht,[l(i(ee),{inset:""},{default:c(()=>[l(i(Z),{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=f=>o.value=f),label:"\u91D1\u989D",readonly:"",clickable:"",clearable:"",formatter:u,maxlength:10,"error-message":s.value,"error-message-align":"right",onTouchstart:v[1]||(v[1]=De(f=>a.value=!0,["stop"])),"input-align":"right"},null,8,["modelValue","error-message"]),l(i(O),null,{default:c(()=>[d("div",yt,[wt,l(b,{category:m.value},null,8,["category"])])]),_:1}),l(i(O),null,{default:c(()=>[d("div",bt,[Et,d("span",null,[(p(!0),k(D,null,B(r.value,f=>(p(),w(le,{ml:"1",tag:f},null,8,["tag"]))),256))])])]),_:1}),l(i(O),null,{default:c(()=>[l(i(Le),{active:t.value,"onUpdate:active":v[2]||(v[2]=f=>t.value=f)},{default:c(()=>[(p(!0),k(D,null,B(i(R),f=>(p(),w(i(Oe),{key:f.name,title:f.name},{default:c(()=>[l(i(Be),{border:!1,clickable:""},{default:c(()=>[l(i(G),{icon:"success",text:"\u4F7F\u7528",onClick:F=>x({category:f.name})},null,8,["onClick"]),(p(!0),k(D,null,B(i(Ue).filter(F=>F.category===f.name),F=>(p(),w(i(G),{onClick:St=>x(F)},{default:c(()=>[d("div",kt,[l(ce,{src:F.icon,height:"50%",width:"50%"},{loading:c(()=>[l(i(Pe),{type:"spinner",size:"20"})]),_:2},1032,["src"]),d("span",xt,E(F.name),1)])]),_:2},1032,["onClick"]))),256))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1})]),_:1}),d("div",Ft,[l(de,{round:"",block:"",type:"success",onClick:S},{default:c(()=>[$t]),_:1})]),l(gt),l(i(Se),{modelValue:o.value,"onUpdate:modelValue":v[3]||(v[3]=f=>o.value=f),"extra-key":".",show:a.value,maxlength:10,onBlur:v[4]||(v[4]=f=>a.value=!1)},null,8,["modelValue","show"])])}}}),M=Re({history:Te(),routes:[{path:"/",name:"Home",component:Ct},{path:"/account",name:"Account",component:()=>T(()=>import("./index.d5f0c96e.js"),["assets/index.d5f0c96e.js","assets/index.97d966c7.css","assets/vendor.ecf1a60c.js","assets/vendor.b7162192.css"])},{path:"/login",name:"Login",component:()=>T(()=>import("./Login.ba683c75.js"),["assets/Login.ba683c75.js","assets/Login.79953f6d.css","assets/vendor.ecf1a60c.js","assets/vendor.b7162192.css"]),meta:{title:"\u767B\u9646"}},{path:"/about",name:"About",component:()=>T(()=>import("./About.0b0970f4.js"),["assets/About.0b0970f4.js","assets/About.1be23510.css","assets/vendor.ecf1a60c.js","assets/vendor.b7162192.css"]),meta:{title:"\u5173\u4E8E"}}],scrollBehavior(n,e,t){return t||{top:0}}});M.beforeEach(async n=>n.name==="Login"||await re()?!0:{name:"Login"});M.beforeEach(n=>{n.meta.title?document.title=n.meta.title+" - "+I:document.title=I});const Dt=L({props:{tag:null},setup(n){const e=n,t=V(()=>{var a,o;return typeof e.tag=="string"?{name:e.tag,color:(o=(a=ze.find(s=>s.name===e.tag))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.tag});return(a,o)=>(p(),w(i(ne),{color:i(t).color},{default:c(()=>[te(a.$slots,"default",{},()=>[P(E(i(t).name),1)])]),_:3},8,["color"]))}}),Lt=L({props:{category:null},setup(n){const e=n,t=V(()=>{var a,o;return typeof e.category=="string"?{name:e.category,color:(o=(a=R.find(s=>s.name===e.category))==null?void 0:a.color)!=null?o:"#F2F3F5"}:e.category});return(a,o)=>(p(),w(i(ne),{color:i(t).color},{default:c(()=>[te(a.$slots,"default",{},()=>[P(E(i(t).name),1)])]),_:3},8,["color"]))}});Me({});const ue=Ve();ue.use(Ae);je(tt).component("Category",Lt).component("Tag",Dt).use(O).use(ee).use(Ie).use(Ne).use(M).use(ue).mount("#app");{document.addEventListener("gesturestart",function(e){e.preventDefault()}),document.addEventListener("dblclick",function(e){e.preventDefault()}),document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()});let n=0;document.addEventListener("touchend",function(e){const t=new Date().getTime();t-n<=300&&e.preventDefault(),n=t},!1)}export{gt as _,Ot as l,I as n};
